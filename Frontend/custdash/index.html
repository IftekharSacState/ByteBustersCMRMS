<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer Dashboard</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Days+One:wght@400&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600&display=swap"
    />
    <link rel="stylesheet" href="index.css" />

    <style>
      body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9;
}

.dashboard {
    width: 80%;
    margin: 20px auto;
    padding: 20px;
    background-color: #ffffff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

h2 {
    text-align: center;
    color: #333;
    font-size: 1.6em;
}

.service-table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    background-color: #f9f9f9;
}

.service-table th, .service-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.service-table th {
    background-color: #4CAF50;
    color: white;
}

.service-table tr:nth-child(even) {
    background-color: #f2f2f2;
}

.service-table tr:hover {
    background-color: #ddd;
}

      #container_iftekhar {
        width: 900px;
        background-color: white;
        margin-top: 1000px;
        padding: 20px;
        margin-left: 500px;
      }

      #container_iftekhar input, #container_iftekhar select, #container_iftekhar label {
        display: block;
      }

      input, select, button {
        margin-bottom: 20px;
      }
      </style>
  </head>
  <body>
    <div class="main-container">
      <div class="rectangle">
        <div class="crmrs"></div>
        <div class="flex-column-bb">
          <a href="../login/index.html">
          <button class="frame-button">
            <div class="frame"><span class="logout">Logout</span></div>
          </button>
          </a>
        </div>
      </div>
      <div class="header">
        <div class="navigation-pill-list"></div>
        <a href="../profilesettingchatbox/index.html">
        <button class="header-auth">
          <div class="button"><span class="profile">Profile</span></div>
        </a>
        </button>
      </div>
      <div class="hello-customer">
        <span class="hello">HELLO, </span
        ><span class="customer" id="customer_name">Customer<br /></span>
      </div>
      <a href="../Homepage/index.html">
      <button class="navigation-pill"><span class="title">Home</span></button>
      </a>
      <div class="image"></div>
      <div class="frame-2">
        <span class="vehicle-health-report">Vehicle Health Report</span>
        <div class="flex-row-cd">
          <div class="checkmark">
            <div class="check-solid"><div class="vector"></div></div>
            <div class="ellipse"></div>
          </div>
          <span class="vehicle-data-transmitting"
            >Vehicle Data Is transmitting: Last serviced 00:00:00 AM PDT
            01/01/2000</span
          >
        </div>
        <div class="flex-row-cb">
          <div class="frame-3">
            <div class="last-known-mileage">
              <span class="last-known-mileage-4">Last Known Mileage</span>
            </div>
            <div class="miles-numbers"><span class="text-b">321597</span></div>
            <div class="total-miles">
              <span class="total-miles-5">Total Miles</span>
            </div>
          </div>
          <div class="frame-6">
            <span class="dashboard-alerts">Dashboard Alerts</span>
            <div class="checkmark-7">
              <div class="check-solid-8"><div class="vector-9"></div></div>
              <div class="ellipse-a"></div>
            </div>
            <span class="no-issues-detected">No Issues Detected</span>
            <div class="med-checkmark">
              <div class="check-solid-b"><div class="vector-c"></div></div>
              <div class="ellipse-d"></div>
            </div>
            <span class="mild-issue-detected">Mild Issue Detected</span>
            <div class="danger-checkmark">
              <div class="check-solid-e"><div class="vector-f"></div></div>
              <div class="ellipse-10"></div>
            </div>
            <span class="crucial-issue-detected">Crucial Issue Detected</span>
          </div>
          <div class="schedule-service-frame">
            <div class="frame-11">
              <span class="schedule-service">Schedule Service</span>
            </div>
            <div class="next-recommended-service">
              <span class="your-next-recommended-service"
                >Your Next Recommended Service</span
              >
            </div>
            <div class="wrapper-7">
              <span class="miles">325000<br />Miles</span>
            </div>
          </div>
          <a href="../appointment/index.html">
          <button class="schedule-service-12">
            <div class="button-13">
              <span class="register">Schedule Service</span>
            </div>
            </button>
          </a>
          <a href="../servicehistory/index.html">
          <button class="health-report">
            <div class="button-14">
              <span class="view-full-health-report"
                >View Full Health Report</span
              >
            </div>
          </button>
        </a>
        
        </div>
        
      </div>
      <div id="container_iftekhar">
        <div class="dashboard">
          <input type="hidden" id="customer_id" />
          <h2>Upcoming Service(s)</h2>
          <table class="service-table" id="upcomingTable">
            <thead>
                  <tr>
                      <th>Date</th>
                      <th>Service</th>
                      <th>Mileage</th>
                      <th>Location</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>11/5/2020</td>
                      <td>Oil change, Rotate Tires, Wiper Fluid</td>
                      <td>324268</td>
                      <td>Somewhere, anywhere</td>
                  </tr>
              </tbody>
          </table>
  
          <h2>Previous Service(s)</h2>
          <table class="service-table" id="previousTable">
            <thead>
                  <tr>
                      <th>Date</th>
                      <th>Service</th>
                      <th>Mileage</th>
                      <th>Location</th>
                  </tr>
              </thead>
              <tbody>
                  <tr>
                      <td>10/25/2020</td>
                      <td>Check for concern</td>
                      <td>310246</td>
                      <td>Somewhere, anywhere</td>
                  </tr>
                  <tr>
                      <td>10/7/2020</td>
                      <td>Engine Failure</td>
                      <td>304250</td>
                      <td>Location</td>
                  </tr>
                  <tr>
                      <td>9/5/2020</td>
                      <td>I have no idea</td>
                      <td>304249</td>
                      <td>Somewhere</td>
                  </tr>
              </tbody>
          </table>
      </div>
      </div>
    </div>

    
  </body>

  <script>
    function getLoggedInUser() {
      // Retrieve user data from localStorage
      const user = JSON.parse(localStorage.getItem("user"));
      const userid = JSON.parse(localStorage.getItem("userid"));

      console.log(userid);
      if (user) {
        // Update the element with the user's name
        document.getElementById("customer_name").innerText = user.username;
        document.getElementById("customer_id").value = userid;

        console.log(`Logged in as: ${user.username}`);
      } else {
        console.log("No user is logged in.");
      }
    }


    getLoggedInUser();

      // Function to fetch appointments based on the logged-in customer's customerId
      function fetchAppointments() {
        const customerId = document.getElementById("customer_id").value;
        if (!customerId) {
          console.log("Customer ID is missing.");
          return;
        }

        // Make a GET request to fetch appointments for the logged-in customer
        fetch(`http://localhost:3000/appointments?customerId=${customerId}`)
          .then((response) => response.json())
          .then((data) => {
            // Check the structure of the data for debugging
            console.log(data);
            
            // Populate both tables with the received data
            populateTable('upcomingTable', data.upcoming);
            populateTable('previousTable', data.previous);
          })
          .catch((error) => {
            console.error("Error fetching appointments:", error);
          });
      }

      // Function to populate a table with appointment data
      function populateTable(tableId, appointments) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector('tbody');
        tbody.innerHTML = '';  // Clear existing rows

        // Loop through each appointment and create a row
        appointments.forEach((appointment) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${appointment.date}</td>
            <td>${appointment.serviceType}</td>
            <td>Not calculated</td>
            <td>Main Branch</td>
          `;
          tbody.appendChild(row);  // Add the row to the table
        });
      }

      // Call fetchAppointments to populate the tables when the page loads
      window.onload = fetchAppointments;
    
  </script>
</html>
