<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> Appointment </title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Days+One:wght@400&display=swap" />
    <link rel="stylesheet" href="index.css" />
    <style>
      #container_iftekhar {
        height: 700px;
        width: 700px;
        background-color: white;
        z-index: 1000000000;
        position: absolute;
        top: 200px;
        right: 200px;
        padding: 20px;
      }

      #container_iftekhar input, #container_iftekhar select, #container_iftekhar label {
        display: block;
      }

      input, select, button {
        margin-bottom: 20px;
      }
      </style>
      
  </head>
  <body>
    <div class="main-container">
      <div class="rectangle"></div>
      <div class="crmrs"></div>
      <button class="navigation-pill">
        <a href="../about/index.html">
        <span class="title">About</span>
        </a>
        </button
      ><button class="navigation-pill-1">
        <a href="../Homepage/index.html">
        <span class="title-2">Home</span>
        </a>
        </button
      ><button class="navigation-pill-3">
        <a href="../faq/index.html">
          <span class="title-4">FAQ</span></button>
        </a>
        
        <button class="navigation-pill-5">
        <a href="../service+/index.html">
          <span class="title-6">Services +</span>
        </a>
      </button>
      <div class="rectangle-7">
        <div class="quote-right"><div class="vector"></div></div>
        <span class="review"
          >⭐⭐⭐⭐⭐ Super easy to schedule! I love being able to log in, track
          my car's repair history, and get reminders. CMRMS makes car
          maintenance stress-free!</span
        >
        <div class="face"></div>
        <span class="name">Catherine Lopez</span
        ><span class="location">ELk Grove, CA</span>
      </div>
      <div class="box-d">
        <div class="section-17"><div class="pic-4"></div></div>
        <span class="text-3c"
          >⭐⭐⭐⭐⭐ Booking was fast, and I love how I can log in to check my
          car’s history. Great service and so convenient—CMRMS is the
          best!</span
        >
        <div class="pic-5"></div>
        <span class="text-3d">Bradford B. Pounds</span
        ><span class="text-3e">Sacramento, CA</span>
      </div>
      
      <div class="group-11">
        <span class="text-40">The Magic Happening here</span
        ><span class="text-41"
          >We specialize in servicing 2000 and newer vehicles with expert care
          and advanced diagnostics for reliable maintenance and repairs.</span
        >
        <div class="box-e">
          <div class="wrapper-12">
            <span class="text-42"
              >Specialized diagnostics using the latest tools for modern
              cars.</span
            >
            <div class="pic-6"></div>
          </div>
          <div class="wrapper-13">
            <span class="text-43"
              >Enhanced performance tuning for vehicles with advanced onboard
              computer systems.</span
            >
            <div class="pic-7"></div>
          </div>
          <div class="group">
            <span class="technicians-trained"
              >Technicians trained in handling advanced systems in newer
              models.</span
            >
            <div class="group-48"></div>
          </div>
        </div>
        <span class="vehicles-serviced">Vehicles we service</span
        ><span class="our-work">Our work</span>
        
      </div>
      
      <div class="pngwing-com"></div>
      <div class="union"></div>
      <span class="hello-lets-talk">Hello, Let’s Talk !</span>
      <span class="schedule-appointment"
        >Schedule a 30 min one-to-one Appointment to discuss your
        challenges</span>
        <span class="optional-recommended">
          <img src="./assets/images/122fc27f-32ad-473e-be1a-a3ca7a1baa8a.png" alt="Icon" class="optional-icon" />
          This is optional but highly recommended!
        </span>
        
      <div class="vector-5b"></div>
    </div>

    <div id="container_iftekhar">
      <h1>Schedule an appointment</h1>
      <form>
        <label>
          Select a service
        </label>
        <select id="service_type_input">
          <option value="oil change">
            Oil Change
          </option>
          <option value="wheel balancing">
            Wheel Balancing Service
          </option>
          <option value="overhaul">
            Overhaul Services
          </option>          
          <option value="brake-repair-maintenance">
            Break Repair and Maintenance
          </option>
          <option value="transmission-services">
            Transmission Services
          </option>
          <option value="engine-diagnostics-repair">
            Engine Diagnostics and Repair
          </option>
          <option value="battery-replacement">
            Battery Replacement
          </option>
          <option value="ac-check-repair">
            AC check and repair
          </option>
          <option value="maintenance-concern-checkup">
            Maintenance Concern Checkup
          </option>
        </select>
        <label>
          Choose a date and time:
        </label>
        <input type="datetime-local" id="date_input" />
        <label>
          Choose a mechanic
        </label>
        <select id="mechanic_input">
          <option value="2">
            Iftekhar Ahmad
          </option>
          <option>
            
          </option>
        </select>
        <input type="hidden" id="customer_id" value="0" />
        <button id="submit_btn">Schedule</button>
      </form>
    </div>
  </body>

  <script>
    // The login function defined here
    async function schedule(event) {

      event.preventDefault(); // Prevent the form from submitting the default way
      const serviceType = document.getElementById("service_type_input").value;
      const date = document.getElementById("date_input").value;
      const mechanicId = document.getElementById("mechanic_input").value;
      const customerId = document.getElementById("customer_id").value;
      //const status = "Under work";


      //const { customerId, mechanicId, date, serviceType, status } = req.body;

      confirm("Are you sure you want to schedule a(n) "+serviceType+" appointment on "+ date);
      try {
        const response = await fetch("http://localhost:3000/appointments/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ customerId, mechanicId,  date, serviceType, status}),
        });

        // Handle the response from the server
        const data = await response.json();

        if (response.ok) {
          // Store the user's data in localStorage
          alert("You're appointment is CONFIRMED for "+date)
          // Redirect to the dashboard
          window.location.href = "../custdash/index.html"; // Adjust the path to your dashboard
        } else {
          alert(data.message); // "Invalid username or password"
        }
      } catch (error) {
        console.error("Error during login:", error);
        alert(
          "An error occurred while trying to log in. Please try again later."
        );
      }
    }

    document.getElementById("submit_btn").addEventListener("click", schedule);

    function getLoggedInUser() {
      // Retrieve user data from localStorage
      const user = JSON.parse(localStorage.getItem("userid"));
      console.log(user);
      if (user) {
        // Update the element with the user's name
        document.getElementById("customer_id").value = user;
      } else {
        console.log("No user is logged in.");
      }
    }

    getLoggedInUser();

  </script>
</html>
